<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Gerador de Banner</title>
  <style>
    body {
      background: #111;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    canvas {
      display: block;
      margin: 20px auto;
      border: 1px solid #444;
    }
    input, button {
      margin: 10px;
      padding: 10px;
    }
  </style>
</head>
<body>
  <h2>Gerador de Banner</h2>
  <input type="text" id="termo" placeholder="Digite o nome do filme ou série">
  <input type="file" id="logoUpload" accept="image/*">
  <br>
  <button onclick="gerarBanner()">Gerar Banner</button>
  <button id="baixarBtn" style="display:none" onclick="baixarBanner()">Baixar Banner</button>
  <canvas id="bannerCanvas" width="1080" height="1920"></canvas>

  <script>
    const API_KEY = "eb93e716b56767d9b0e6d4fdcf25a511";
    const canvas = document.getElementById('bannerCanvas');
    const ctx = canvas.getContext('2d');

    async function gerarBanner() {
      const termo = document.getElementById("termo").value;
      const logoFile = document.getElementById("logoUpload").files[0];

      if (!termo) return alert("Digite um título.");

      const busca = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${API_KEY}&language=pt-BR&query=${encodeURIComponent(termo)}`);
      const resultado = await busca.json();
      const item = resultado.results?.[0];

      if (!item) return alert("Nenhum resultado encontrado.");

      const imgPath = item.poster_path || item.backdrop_path;
      const sinopse = item.overview || "Sinopse não encontrada.";

      const fundo = await carregarImagem("fundo-padrao.jpg");
      const imagemTMDB = imgPath ? await carregarImagem(`https://image.tmdb.org/t/p/w500${imgPath}`) : null;
      const logo = logoFile ? await carregarImagem(URL.createObjectURL(logoFile)) : null;

      ctx.drawImage(fundo, 0, 0, canvas.width, canvas.height);

      if (imagemTMDB) ctx.drawImage(imagemTMDB, 340, 240, 400, 600); // dentro da moldura

      ctx.fillStyle = "#fff";
      ctx.font = "bold 40px Arial";
      ctx.fillText("SINOPSE", 80, 900);

      ctx.font = "30px Arial";
      wrapText(ctx, sinopse, 80, 950, 920, 40);

      if (logo) ctx.drawImage(logo, 40, 1720, 300, 100); // canto inferior esquerdo

      document.getElementById("baixarBtn").style.display = "inline-block";
    }

    function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
      const words = text.split(' ');
      let line = '';
      for (let n = 0; n < words.length; n++) {
        const testLine = line + words[n] + ' ';
        const metrics = ctx.measureText(testLine);
        if (metrics.width > maxWidth && n > 0) {
          ctx.fillText(line, x, y);
          line = words[n] + ' ';
          y += lineHeight;
        } else {
          line = testLine;
        }
      }
      ctx.fillText(line, x, y);
    }

    function carregarImagem(src) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.onload = () => resolve(img);
        img.onerror = reject;
        img.src = src;
      });
    }

    function baixarBanner() {
      const link = document.createElement('a');
      link.download = 'banner.png';
      link.href = canvas.toDataURL();
      link.click();
    }
  </script>
</body>
</html>
